<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Endpoint Tester</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2, h3 {
            color: #333;
        }
        .endpoint-group {
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
        }
        .endpoint {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 10px;
        }
        .endpoint-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .method {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 3px;
            color: white;
        }
        .get { background-color: #61affe; }
        .post { background-color: #49cc90; }
        .put { background-color: #fca130; }
        .delete { background-color: #f93e3e; }
        .endpoint-path {
            font-family: monospace;
            font-size: 16px;
            margin-left: 10px;
        }
        .test-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background-color: #45a049;
        }
        .params {
            margin-top: 10px;
        }
        .param-row {
            display: flex;
            margin-bottom: 5px;
        }
        .param-name {
            width: 150px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            background-color: #f1f1f1;
        }
        .param-value {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 0 4px 4px 0;
        }
        .request-body {
            width: 100%;
            height: 100px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            margin-top: 10px;
        }
        #token-input {
            width: 100%;
            padding: 8px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }
        #response {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-x: auto;
            min-height: 200px;
            max-height: 500px;
            overflow-y: auto;
        }
        .log-line {
            margin: 0;
            padding: 2px 0;
        }
        .log-error { color: #f93e3e; }
        .log-success { color: #49cc90; }
        .log-info { color: #61affe; }
        #clear-logs {
            margin-top: 10px;
            background-color: #f44336;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        #clear-logs:hover {
            background-color: #d32f2f;
        }
        .toggle-section {
            cursor: pointer;
            display: inline-block;
            margin-left: 10px;
            color: #2196F3;
        }
        .section-content {
            display: none;
        }
        #search-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>API Endpoint Tester</h1>

        <div>
            <h3>Authentication Token</h3>
            <input type="text" id="token-input" placeholder="Enter your JWT token here..." 
                   value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjEsInJvbGUiOiJzdHVkZW50IiwiaWF0IjoxNjI5MjYxNzAyfQ.cMbOLPI8L_6c5S5yLIk6Z7Y5HqkEj6PGuPQMVx2b7A">
        </div>

        <div>
            <input type="text" id="search-input" placeholder="Search endpoints...">
        </div>

        <div class="endpoint-group">
            <h2>Auth Endpoints</h2>
            <div class="endpoint">
                <div class="endpoint-header">
                    <div>
                        <span class="method post">POST</span>
                        <span class="endpoint-path">/api/auth/login</span>
                    </div>
                    <button class="test-button" data-method="POST" data-url="/api/auth/login">Test</button>
                </div>
                <div class="params">
                    <textarea class="request-body" placeholder="Request body (JSON)">
{
  "email": "student@example.com",
  "password": "password123"
}
                    </textarea>
                </div>
            </div>

            <div class="endpoint">
                <div class="endpoint-header">
                    <div>
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/auth/me</span>
                    </div>
                    <button class="test-button" data-method="GET" data-url="/api/auth/me">Test</button>
                </div>
            </div>
        </div>

        <div class="endpoint-group">
            <h2>Student Endpoints</h2>
            <div class="endpoint">
                <div class="endpoint-header">
                    <div>
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/students/dashboard</span>
                    </div>
                    <button class="test-button" data-method="GET" data-url="/api/students/dashboard">Test</button>
                </div>
            </div>

            <div class="endpoint">
                <div class="endpoint-header">
                    <div>
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/students/courses</span>
                    </div>
                    <button class="test-button" data-method="GET" data-url="/api/students/courses">Test</button>
                </div>
            </div>

            <div class="endpoint">
                <div class="endpoint-header">
                    <div>
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/students/assignments/upcoming</span>
                    </div>
                    <button class="test-button" data-method="GET" data-url="/api/students/assignments/upcoming">Test</button>
                </div>
            </div>

            <div class="endpoint">
                <div class="endpoint-header">
                    <div>
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/students/schedule</span>
                    </div>
                    <button class="test-button" data-method="GET" data-url="/api/students/schedule">Test</button>
                </div>
            </div>

            <div class="endpoint">
                <div class="endpoint-header">
                    <div>
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/students/grades/recent</span>
                    </div>
                    <button class="test-button" data-method="GET" data-url="/api/students/grades/recent">Test</button>
                </div>
            </div>

            <div class="endpoint">
                <div class="endpoint-header">
                    <div>
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/students/attendance</span>
                    </div>
                    <button class="test-button" data-method="GET" data-url="/api/students/attendance">Test</button>
                </div>
            </div>

            <div class="endpoint">
                <div class="endpoint-header">
                    <div>
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/students/submissions</span>
                    </div>
                    <button class="test-button" data-method="GET" data-url="/api/students/submissions">Test</button>
                </div>
            </div>
        </div>

        <div class="endpoint-group">
            <h2>Course Endpoints</h2>
            <div class="endpoint">
                <div class="endpoint-header">
                    <div>
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/courses</span>
                    </div>
                    <button class="test-button" data-method="GET" data-url="/api/courses">Test</button>
                </div>
            </div>

            <div class="endpoint">
                <div class="endpoint-header">
                    <div>
                        <span class="method get">GET</span>
                        <span class="endpoint-path">/api/courses/:id</span>
                    </div>
                    <button class="test-button" data-method="GET" data-url="/api/courses/">Test</button>
                </div>
                <div class="params">
                    <div class="param-row">
                        <input type="text" class="param-name" value="id" readonly>
                        <input type="text" class="param-value" placeholder="Enter course ID">
                    </div>
                </div>
            </div>
        </div>

        <h2>Response & Logs</h2>
        <button id="clear-logs">Clear Logs</button>
        <div id="response"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const BASE_URL = 'http://localhost:3001';
            const responseEl = document.getElementById('response');
            const tokenInput = document.getElementById('token-input');
            const clearLogsBtn = document.getElementById('clear-logs');
            const searchInput = document.getElementById('search-input');
            const endpoints = document.querySelectorAll('.endpoint');

            // Clear logs
            clearLogsBtn.addEventListener('click', function() {
                responseEl.innerHTML = '';
            });

            // Search endpoints
            searchInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                endpoints.forEach(endpoint => {
                    const path = endpoint.querySelector('.endpoint-path').textContent.toLowerCase();
                    const method = endpoint.querySelector('.method').textContent.toLowerCase();
                    if (path.includes(query) || method.includes(query)) {
                        endpoint.style.display = 'block';
                    } else {
                        endpoint.style.display = 'none';
                    }
                });
            });

            // Log message to the response area
            function log(message, type = 'info') {
                const p = document.createElement('p');
                p.className = `log-line log-${type}`;
                p.textContent = message;
                responseEl.appendChild(p);
                responseEl.scrollTop = responseEl.scrollHeight;
            }

            // Format JSON response
            function formatResponse(data) {
                try {
                    return JSON.stringify(data, null, 2);
                } catch (e) {
                    return data;
                }
            }

            // Test endpoint
            async function testEndpoint(method, url, body = null, params = {}) {
                const token = tokenInput.value.trim();
                const fullUrl = new URL(BASE_URL + url);
                
                // Add query parameters
                Object.keys(params).forEach(key => {
                    if (params[key]) {
                        if (url.includes(`:${key}`)) {
                            // Replace path parameter
                            fullUrl.pathname = fullUrl.pathname.replace(`:${key}`, params[key]);
                        } else {
                            // Add query parameter
                            fullUrl.searchParams.append(key, params[key]);
                        }
                    }
                });

                log(`${method} request to: ${fullUrl.toString()}`);
                
                try {
                    const headers = {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    };
                    
                    if (token) {
                        headers['Authorization'] = `Bearer ${token.trim()}`;
                        log(`Using token: ${token.substring(0, 15)}...`);
                    }

                    const options = {
                        method,
                        headers: new Headers(headers)
                    };

                    if (body && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {
                        options.body = body;
                        log(`Request body: ${body}`);
                    }

                    const response = await fetch(fullUrl.toString(), options);
                    const contentType = response.headers.get('content-type');
                    
                    if (contentType && contentType.includes('application/json')) {
                        const data = await response.json();
                        log(`Response status: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                        log(`Response data: ${formatResponse(data)}`, response.ok ? 'success' : 'error');
                        return data;
                    } else {
                        const text = await response.text();
                        log(`Response status: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                        log(`Response data: ${text}`, response.ok ? 'success' : 'error');
                        return text;
                    }
                } catch (error) {
                    log(`Error: ${error.message}`, 'error');
                    console.error(error);
                    return null;
                }
            }

            // Add event listeners to test buttons
            document.querySelectorAll('.test-button').forEach(button => {
                button.addEventListener('click', async function() {
                    const method = this.getAttribute('data-method');
                    let url = this.getAttribute('data-url');
                    
                    // Get parameters if any
                    const paramsContainer = this.closest('.endpoint').querySelector('.params');
                    let params = {};
                    let body = null;

                    if (paramsContainer) {
                        // Get path parameters
                        const paramRows = paramsContainer.querySelectorAll('.param-row');
                        paramRows.forEach(row => {
                            const name = row.querySelector('.param-name').value;
                            const value = row.querySelector('.param-value').value;
                            params[name] = value;
                            
                            // If it's a path parameter, replace in URL
                            if (url.includes(`:${name}`)) {
                                url = url.replace(`:${name}`, value);
                            }
                        });

                        // Get request body
                        const bodyTextarea = paramsContainer.querySelector('.request-body');
                        if (bodyTextarea && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {
                            body = bodyTextarea.value.trim();
                        }
                    }

                    await testEndpoint(method, url, body, params);
                });
            });

            // Add parameterized endpoints dynamically
            document.querySelectorAll('.param-value').forEach(input => {
                input.addEventListener('input', function() {
                    const name = this.closest('.param-row').querySelector('.param-name').value;
                    const button = this.closest('.endpoint').querySelector('.test-button');
                    let url = button.getAttribute('data-url');
                    
                    if (url.endsWith('/') && this.value) {
                        button.setAttribute('data-url', url + this.value);
                    }
                });
            });

            // Initialize with a log message
            log('API Tester initialized. Select an endpoint to test.');
            log(`Base URL: ${BASE_URL}`);
        });
    </script>
</body>
</html> 